<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpCloud</title>
    <!-- 引入 Vue 2 的 CDN -->
    <script src="/simpserver/static/source/vue.min.js"></script>
    <!-- 引入 Md5 的 CDN -->
    <script src="/simpserver/static/source/md5.min.js"></script>
    <!-- 引入 AXIOS 的 CDN -->
    <script src="/simpserver/static/source/axios.js"></script>
    <!-- 引入组件库 -->
    <script src="/simpserver/static/source/element.js"></script>
    <link rel="stylesheet" href="/simpserver/static/source/element.css">
    <link rel="shortcut icon" href="/simpserver/static/source/Icon.jpg">
    <link rel="stylesheet" href="/simpserver/web/style.css">
</head>

<body>
    <div id="app">
        <el-col :span="4" style="height: 100vh;box-sizing: border-box;border-right: 1px solid #EBEEF5">
            <h1 style="color: rgb(207, 15, 124);text-align: center;font-family: fantasy;" class="app-bigger-size">
                <i class="el-icon-help app-bigger-size" style="color: rgb(207, 90, 124);font-size: 36px;"></i>Simp
            </h1>
            <el-menu class="el-menu-vertical-demo" active-text-color="rgb(207, 15, 124)" style="border: none">
                <el-menu-item v-for="(item,index) in serverList " class="app-text-center" :index="item" :key="index" @click="handleOpen(item)">
                    <i class="el-icon-menu app-not-show"></i>
                    <span slot="title">{{item}}</span>
                </el-menu-item>
            </el-menu>
        </el-col>
        <el-col :span="20">
            <el-card shadow="hover">
                <div style="height: 70px;display: flex;align-items: center;justify-content: space-around;">
                    <div class="flex-item">
                        <div @click="createServerVisible = true" style="color: rgb(207, 15, 124);cursor: pointer;">
                            CreateServer</div>
                    </div>
                    <div class="flex-item">
                        <div @click="GetMainLogList()" style="color: rgb(207, 15, 124);cursor: pointer;">CheckLog</div>
                    </div>
                    <div class="flex-item">
                        <div style="font-weight: 700;">ServerCounts</div>
                        <div style="color: rgb(207, 15, 124);">{{serverList.length}}</div>
                    </div>
                </div>
            </el-card>
            <el-card shadow="hover" v-if="!serverName">
                <div style="display: flex;height: 700px;" v-if="activeName=='logger'">
                    <div style="width: 13%;margin-right: 2%;">
                        <el-select v-model="loggerFile">
                            <el-option v-for="item in mainLogList" :key="item" :value="item" :label="item"></el-option>
                        </el-select>
                        <br />
                        <br />
                        <el-input v-model="pattern"></el-input>
                        <br />
                        <br />
                        <el-button @click="GetServerLogger()" type="primary">Search</el-button>
                    </div>
                    <div class="resu"
                        style="background-color: black;height: 700px;padding: 5px 10px;width: 85%;overflow: scroll;">
                        <div style="color: aliceblue;">SimpMainControlLogServer :: {{ serverName }} :: created By leeks
                        </div>
                        <div style="color: aliceblue;margin: 2px;" v-for="item in logger">{{ item }}</div>
                    </div>
                </div>
            </el-card>
            <el-card shadow="hover" v-if="serverName">
                <div style="height: 70px;display: flex;align-items: center;justify-content: space-around;">

                    <div class="flex-item ">
                        <div style="font-weight: 700;">PackageCounts</div>
                        <div style="color: rgb(207, 15, 124);">{{packageList.length}}</div>
                    </div>
                    <div class="flex-item ">
                        <div style="font-weight: 700;">ServerName</div>
                        <div style="color: rgb(207, 15, 124);cursor: pointer;" @click="showConfig()">{{serverName ||
                            '--'}}</div>
                    </div>
                    <div class="flex-item ">
                        <div style="font-weight: 700;">Pid</div>
                        <div style="color: rgb(207, 15, 124);">{{status.pid || '--'}}</div>
                    </div>
                    <div class="flex-item ">
                        <div style="font-weight: 700;">Status</div>
                        <div style="color: rgb(207, 15, 124);">{{status.status || '--'}}</div>
                    </div>
                    <div class="flex-item ">
                        <div @click="uploadVisible = true" style="color: rgb(207, 15, 124);cursor: pointer;">Upload
                        </div>
                    </div>
                    <div class="flex-item ">
                        <div @click="ShutDownServer()" style="color: rgb(207, 15, 124);cursor: pointer;">Shutdown</div>
                    </div>

                    <div class="flex-item ">
                        <div @click="releaseVisible=true" style="color: rgb(207, 15, 124);cursor: pointer;">Release
                        </div>
                    </div>

                </div>
            </el-card>
            <el-card shadow="hover" v-if="serverName" style="padding: 0;">
                <el-tabs v-model="activeName">
                    <el-tab-pane label="logger" name="logger">
                        <div style="display: flex;height: 700px;" v-if="activeName=='logger'">
                            <div style="width: 13%;margin-right: 2%;">
                                <el-select v-model="loggerFile">
                                    <el-option v-for="item in loggerList" :key="item" :value="item"
                                        :label="item"></el-option>
                                </el-select>
                                <br />
                                <br />
                                <el-input v-model="pattern"></el-input>
                                <br />
                                <br />
                                <el-button @click="GetServerLogger()" type="primary">Search</el-button>
                            </div>
                            <div class="resu"
                                style="background-color: black;height: 700px;padding: 5px 10px;width: 85%;overflow: scroll;">
                                <div style="color: aliceblue;">SimpLogServer :: {{ serverName }} :: created By leeks
                                </div>
                                <div style="color: aliceblue;margin: 2px;" v-for="item in logger">{{ item }}</div>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="api" name="api">
                        <div v-if="activeName=='api'">
                            <div v-for="item in apis">
                                <div
                                    style="display: flex;align-items: center;justify-content: space-between;margin: 5px;">
                                    <el-button type="text">{{item.method}} | {{item.path}}</el-button>
                                    <el-button type="primary">invoke</el-button>
                                </div>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="doc" name="doc">
                        <div v-if="activeName=='doc'">
                            <div>
                                {{ doc }}
                            </div>
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </el-card>
            <el-card>
                <div class="intro" style="display: flex;align-items: center;justify-content: center;">
                    <div>created by <a href="/simpserver/static/source/resume.docx">leemulus21@gmail.com</a></div>
                    <span> &nbsp;&nbsp;&nbsp;&nbsp;- -&nbsp;&nbsp;&nbsp;&nbsp; </span>
                    <div>built by <span style="color: rgb(113, 214, 113);">vue</span> and <span style="color: rgb(10, 219, 205);">gin</span></div>
                    <span> &nbsp;&nbsp;&nbsp;&nbsp;- -&nbsp;&nbsp;&nbsp;&nbsp; </span>
                    <div>at 2024</div>
                    <span> &nbsp;&nbsp;&nbsp;&nbsp;- -&nbsp;&nbsp;&nbsp;&nbsp; </span>
                    <div><a href="https://github.com/chelizichen/Simp">star simp</a></div>
                </div>
            </el-card>
            <!-- 文件上传表单 -->
            <el-dialog append-to-body :visible="uploadVisible" width="50%" title="Release">
                <el-form :model="uploadForm" label-width="150px">
                    <el-form-item label="Server Name" required>
                        <el-input v-model="uploadForm.serverName" disabled></el-input>
                    </el-form-item>
                    <el-form-item label="Document" required>
                        <el-input v-model="uploadForm.doc" type="textarea" row="5"></el-input>
                    </el-form-item>
                    <el-form-item label="File" required>
                        <el-upload :show-file-list="true" :on-change="handleFileChange" :auto-upload="false"
                            action="/upload">
                            <el-button slot="trigger" size="small">Choose File</el-button>
                        </el-upload>
                    </el-form-item>
                </el-form>
                <span slot="footer">
                    <div style="display: flex;align-items: center;justify-content: center;">
                        <el-button type="primary" @click="uploadVisible=false">Close</el-button>
                        <el-button type="success" @click="uploadFile">Upload</el-button>
                    </div>
                </span>
            </el-dialog>
            <el-dialog append-to-body :visible="configVisible" title="Server Configuration" width="60%">
                <el-form :model="config" label-width="100px">
                    <el-form-item label="Name">
                        <el-input v-model="config.Name" disabled></el-input>
                    </el-form-item>
                    <el-form-item label="Host">
                        <el-input v-model="config.Host"></el-input>
                    </el-form-item>
                    <el-form-item label="Port">
                        <el-input v-model="config.Port" disabled></el-input>
                    </el-form-item>
                    <el-form-item label="Type">
                        <el-input v-model="config.Type" disabled></el-input>
                    </el-form-item>
                    <el-form-item label="Static Path">
                        <el-input v-model="config.StaticPath"></el-input>
                    </el-form-item>
                    <el-form-item label="Storage">
                        <el-input v-model="config.Storage"></el-input>
                    </el-form-item>
                </el-form>
                <span slot="footer">
                    <div style="display: flex;align-items: center;justify-content: center;">
                        <el-button type="primary" @click="configVisible=false">Close</el-button>
                        <el-button type="success" @click="previewSubServer()">Preivew</el-button>
                        <el-button type="danger" @click="uploadConfig()">Upload</el-button>
                    </div>
                </span>
            </el-dialog>

            <el-dialog append-to-body :visible="createServerVisible" title="Create Server" width="60%">
                <el-form :model="config" label-width="100px">
                    <el-form-item label="Name">
                        <el-input v-model="createServerName"></el-input>
                    </el-form-item>
                </el-form>
                <span slot="footer">
                    <div style="display: flex;align-items: center;justify-content: center;">
                        <el-button type="primary" @click="createServerVisible=false">Close</el-button>
                        <el-button type="success" @click="createServer()">Create</el-button>
                    </div>
                </span>
            </el-dialog>

            <el-dialog append-to-body :visible="releaseVisible" title="Release Server" width="60%">
                <el-select v-model="selectRelease" placeholder="请选择" style="width: 100%;">
                    <el-option v-for="item in packageList" :key="item.Hash"
                        :label="serverName + '_' + item.Hash + '.tar.gz'"
                        :value="serverName + '_' + item.Hash + '.tar.gz'">
                        <span style="float: left">{{ serverName }}</span>
                        <span style="float: right;" @click="DeletePackage(item.Hash)">
                            <i class="el-icon-remove" style="color: crimson;cursor: pointer;"></i>
                        </span>
                        <span style="float: right; color: #8492a6; font-size: 13px">
                            {{ item.Hash }} &nbsp;
                        </span>
                    </el-option>
                </el-select>
                <span slot="footer">
                    <div style="display: flex;align-items: center;justify-content: center;">
                        <el-button type="primary" @click="releaseVisible = false">Close</el-button>
                        <el-button type="success" @click="restartServer()">Release</el-button>
                        <el-button type="danger" @click="uploadVisible = true">Upload</el-button>
                    </div>
                </span>

            </el-dialog>

        </el-col>
    </div>
    <script src="/simpserver/web/api.js" defer></script>
    <script src="/simpserver/web/client.js" defer></script>
</body>

</html>